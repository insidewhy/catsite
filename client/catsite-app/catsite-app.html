<polymer-element name="catsite-status" attributes="switches">
  <style shim-shadowdom>
    ::shadow .switch {
      clear: left;
      height: 35px;
      line-height: 35px;
    }
    ::shadow .switch-name {
      width: 6em;
      float: left;
    }
    ::shadow paper-toggle-button {
      margin-top: 10px;
    }
  </style>
  <template>
    <template repeat="{{switch in switches}}">
      <div class="switch clearfix">
        <div class="switch-name">{{switch.name}}</div>
        <paper-toggle-button/>
      </div>
    </template>
  </template>
  <script>
    Polymer({
    })
  </script>
</polymer-element>

<polymer-element name="catsite-app">
  <template>
    <core-ajax auto url=/status handleAs=json on-core-response="{{onStatus}}"></core-ajax>
    <core-header-panel>
      <core-toolbar>
        <paper-tabs id=tabs selected="{{selected}}" self-end>
          <paper-tab name=status>Current Status</paper-tab>
          <paper-tab name=calendar>Power Switch Calendar</paper-tab>
        </paper-tabs>
      </core-toolbar>
      <core-pages selected="{{selected}}">
        <catsite-status name=status switches="{{switches}}">
        </catsite-status>
        <div name=calendar>Calendar page</div>
      </core-pages>
      <!-- main page content will go here -->
    </core-header-panel>
  </template>
  <style shim-shadowdom>
    html,body {
      height: 100%;
      margin: 0;
      font-family: 'RobotoDraft', sans-serif;
    }
    ::shadow core-header-panel {
      height: 100%;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }
    ::shadow core-toolbar {
      margin-top: 0px;
      background: #aa55bb;
      color: white;
    }
    ::shadow #tabs {
      width: 100%;
      margin: 0;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      text-transform: uppercase;
    }
    ::shadow core-pages {
      margin: 20px 40px;
    }
  </style>
  <script>
    Polymer({
      selected: 'status',
      switches: {},
      onStatus: function(e) {
        this.switches = _.sortBy(_.map(e.detail.response, function(val, key) {
          val.name = key
          return val
        }), 'idx')
      }
    })
  </script>
</polymer-element>
